#   The 4-node-quickstart.yml launches a containerlab XRd topology where the XRd instances are connected
#   via point-to-point links: https://containerlab.dev/manual/network/#point-to-point-links
#
#   Topology
#
#                                                                                                                 L0
#                                                                                                                 L0
#                                                        L0                                                       fc00:0:2::1/128              10.21.255.255/32
#                                                        fc00:0:1::1/128             fc00:0:3::1/128
#
#                                                                                                                                                                          PC21
#             PC11                                       SRv6 Locator                                                          192.168.21.0/24
#                                                         c00:0:1::/48                                         SRv6 Locator
#                                                                                                              fc00:0:2::/48                                  10.21.1.0/24
#                                       192.168.11.0/24                                                                          .1        .2     CE21
#   10.11.1.0/24        10.11.255.255/32                                2001:13::/64                 2001:23::/64                                 FRR
#                            +---------+     ipv4                                                                                   ipv4        +----------+              +--------+
#            +-----+ .2  .2  |         |     ebgp         +---------+                  +---------+                   +---------+    ebgp        |          | .1       .2  |        |
#            |     |         |         |                  |         |                  |         |                   |         |                |          |              |        |
#            |     +---------+         +------------------+         |                  |         |                   |         +----------------+          +--------------+        |
#            |     |eth1     |         | eth1             |         | :1          :3   |         | :3            :2  |         | 3         eth1 |          | eth3         |        |
#            |     |         |         |              3   |         |                  |         |                   |         |                |          |              +--------+
#            +-----+   eth3  +---------+              3   |         |                  |         |                   |         |                +----------+
#                                                         |         | 1              1 |         |  2            2   |         |                                     eth1
#                             CE11                        |         +------------------+         +-------------------+         |
#                             FRR                         |         |                  |         |                   |         |    192.168.22.0/24
#                                                         |         |                  |         |                   |         |
#                                                         |         |                  |   P     |                   |  PE2    |   .1         .2
#                                                         |  PE1    |                  |  XRD03  |                   |  XRD02  | 4               +----------+
#                              +-------+                  |  XRD01  |                  |         |                   |         +-----------------+          |        eth1 +--------+
#             +-----+          |       +------------------+         |                  |         |                   |         |            eth1 |          |             |        |
#             |     |          | CE12  |                  |         |                  +---------+                   |         |    ipv4         |   CE22   | eth3        |        |
#             | PC12+----------+ FRR   |              5   |         |                                                |         |    ebgp         |   FRR    +-------------+  PC22  |
#             |     |          |       |                  |         |                                                |         |                 |          |             |        |
#             +-----+          |       |                  |         |                                                |         |                 +----------+             +--------+
#                              +-------+                  |         |                                                |         |
#                                                         |         |                                                |         |
#                                                         |         |                                                |         |
#                                                         |         |                                                |         |
#                                                         |         |                                                |         |                  +----------+
#                                                         |         |                                                |         |                  |          |              +-------+
#                                                         |         |                                                |         | 5                | CE31     |              |       |
#                                                         |         |                                                |         +------------------+          +--------------+       |
#                                                         |         |                                                |         |                  |          |              | PC31  |
#                                                         |         |                                                |         |                  |          |              |       |
#                                                         +---------+                                                +---------+                  +----------+              +-------+
#
#                            |
#         -------------------+----------------------------------------           -----------------------             ------------------------------------------------------------------
#
#                                         site1                                         core                                          site2

name: srv6_lab1

mgmt:
  network: mgt_net
  ipv4-subnet: 172.20.1.0/24
  ipv6-subnet: 2001:db8:20:1::/64

topology:
  nodes:
    pe1:
      kind: cisco_xrd
      image: tdesh10/xrd-control-plane:7.8.1
      mgmt-ipv4: 172.20.1.101
      mgmt-ipv6: 2001:db8:20:1::101
      startup-config: config/pe1.cfg

    pe2:
      kind: cisco_xrd
      image: tdesh10/xrd-control-plane:7.8.1
      mgmt-ipv4: 172.20.1.102
      mgmt-ipv6: 2001:db8:20:1::102
      startup-config: config/pe2.cfg

    p:
      kind: cisco_xrd
      image: tdesh10/xrd-control-plane:7.8.1
      mgmt-ipv4: 172.20.1.103
      mgmt-ipv6: 2001:db8:20:1::103
      startup-config: config/p.cfg

    ce11:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      mgmt-ipv4: 172.20.1.11
      binds:
        - config/daemons:/etc/frr/daemons
        - config/ce11-frr.conf:/etc/frr/frr.conf

    ce12:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      mgmt-ipv4: 172.20.1.12
      binds:
        - config/daemons:/etc/frr/daemons
        - config/ce12-frr.conf:/etc/frr/frr.conf

    ce21:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      mgmt-ipv4: 172.20.1.21
      binds:
        - config/daemons:/etc/frr/daemons
        - config/ce21-frr.conf:/etc/frr/frr.conf

    ce22:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      mgmt-ipv4: 172.20.1.22
      binds:
        - config/daemons:/etc/frr/daemons
        - config/ce22-frr.conf:/etc/frr/frr.conf

    ce31:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      mgmt-ipv4: 172.20.1.31
      binds:
        - config/daemons:/etc/frr/daemons
        - config/ce31-frr.conf:/etc/frr/frr.conf

    pc11:
      kind: linux
      image: praqma/network-multitool:latest
    pc12:
      kind: linux
      image: praqma/network-multitool:latest
    pc21:
      kind: linux
      image: praqma/network-multitool:latest
    pc22:
      kind: linux
      image: praqma/network-multitool:latest
    pc31:
      kind: linux
      image: praqma/network-multitool:latest
    # xrd01-host:
    #   kind: bridge

    # xrd02-host:
    #   kind: bridge

  links:
    - endpoints: ["pe1:Gi0-0-0-1", "p:Gi0-0-0-1"]
    - endpoints: ["pe1:Gi0-0-0-3", "ce11:eth1"]
    - endpoints: ["pe1:Gi0-0-0-5", "ce12:eth1"]

    - endpoints: ["p:Gi0-0-0-2", "pe2:Gi0-0-0-2"]
    - endpoints: ["pe2:Gi0-0-0-3", "ce21:eth1"]
    - endpoints: ["pe2:Gi0-0-0-4", "ce22:eth1"]
    - endpoints: ["pe2:Gi0-0-0-5", "ce31:eth1"]

    - endpoints: ["pc11:eth1", "ce11:eth3"]
    - endpoints: ["pc12:eth1", "ce12:eth3"]
    - endpoints: ["pc21:eth1", "ce21:eth3"]
    - endpoints: ["pc22:eth1", "ce22:eth3"]
    - endpoints: ["pc31:eth1", "ce31:eth3"]
